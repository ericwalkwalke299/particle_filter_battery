function [obj]=ecm_obj_fun(theta)


R = theta(1);
Q = theta(2);
C = theta(3);
R_ct = theta(4);

global first_discharge_time first_discharge_current...
    first_discharge_voltage;
SOC_cell = 1 + first_discharge_current / (3600 * Q) .*...
    first_discharge_time;

SOC_n = 0.79*SOC_cell + 0.01;
SOC_p = 0.97-0.51*SOC_cell; 

x_nsurf = SOC_n;
x_psurf_set = SOC_p;

U_n     = .7222 + .1387*x_nsurf + .029*x_nsurf.^0.5 - .0172./...
    x_nsurf + ...
        .0019./x_nsurf.^1.5 + .2808 * exp(0.9-15*x_nsurf) -...
        .7984 * exp (...
        0.4465*x_nsurf - 0.4108);
    
U_p_set     = ( -4.656 + 88.669 * x_psurf_set.^2 - 401.119 *...
    x_psurf_set.^4 + 342.909 * ...
        x_psurf_set.^6 - 462.471 * x_psurf_set.^8 + 433.434 *...
        x_psurf_set.^10 ) ./ ...
        ( -1 + 18.933*x_psurf_set.^2 - 79.532 * x_psurf_set.^4 ...
        + 37.311 * x_psurf_set.^6 ...
        - 73.083 * x_psurf_set.^8 + 95.96*x_psurf_set.^10 );

V_o = U_p_set - U_n ;

V_cell = V_o + first_discharge_current.*R + Q./C .* exp(...
    -first_discharge_time./(R_ct * C))...
    + first_discharge_current.*R_ct.*(1-exp(...
    -first_discharge_time./(R_ct * C)));


obj = first_discharge_voltage - V_cell ;
